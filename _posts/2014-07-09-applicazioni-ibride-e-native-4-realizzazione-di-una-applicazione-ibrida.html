---
layout: post
title: 'Applicazioni Ibride e Native #4 – Realizzazione di una Applicazione Ibrida'
date: 2014-07-09 14:00:39.000000000 +02:00
categories:
- Applicazioni Ibride e Native
- Programmazione
tags:
- angularjs
- applicazioni ibride
- bower
- cordova
- grunt
- ionic
- javascript
- yeoman
status: publish
type: post
published: true
---
<h2>Strumenti Utilizzati</h2>
<h3>Cordova e plugins</h3>
<p class="western">Per realizzare l'applicazione è stato utilizzato Cordova 3.4.1 ed i seguenti plugin:</p>
<p class="western">
<p><!--more--></p>
<ul>
<li>
<p class="western"><a href="https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin">SocialSharing-PhoneGap-Plugin</a>: per permettere all'utente di condividere le foto scattate. Documentazione ed ulteriori informazioni sono presenti presso la repository github: <span lang="zxx"><a href="https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin">https://github.com/EddyVerbruggen/SocialSharing-PhoneGap-Plugin</a></span></p>
</li>
<li>
<p class="western"><span lang="zxx"><a href="http://plugins.cordova.io/#/package/org.apache.cordova.camera">Cordova Camera Plugin:</a> per avere accesso alla fotocamera del dispositivo. Documentazione e ulteriori informazioni nella pagina del plugin: <a href="http://plugins.cordova.io/#/package/org.apache.cordova.camera">http://plugins.cordova.io/#/package/org.apache.cordova.camera</a></span></p>
</li>
<li>
<p class="western"><span lang="zxx"><a href="http://plugins.cordova.io/#/package/org.apache.cordova.device">Cordova Device Plugin</a>: fornisce una descrizione dell'hardware e del software del dispositivo. </span><span lang="zxx">Documentazione e ulteriori informazioni nella pagina del plugin: </span><a href="http://plugins.cordova.io/#/package/org.apache.cordova.device"><span lang="zxx">http://plugins.cordova.io/#/package/org.apache.cordova.device</span></a></p>
</li>
<li>
<p class="western"><span lang="zxx"><a href="http://plugins.cordova.io/#/package/org.apache.cordova.file">Cordova File Plugin</a>: per memorizzare nel filesystem locale le fo</span><span lang="zxx">t</span><span lang="zxx">o scatta</span><span lang="zxx">t</span><span lang="zxx">e. </span><span lang="zxx">Documentazione e ulteriori informazioni nella pagina del plugin: </span><a href="http://plugins.cordova.io/#/package/org.apache.cordova.file"><span lang="zxx">http://plugins.cordova.io/#/package/org.apache.cordova.file</span></a></p>
</li>
<li>
<p class="western"><span lang="zxx"><a href="http://plugins.cordova.io/#/package/org.apache.cordova.geolocation">Cordova Geolocation Plugin</a>: utilizzato per determinare la posizione dell'utente. </span><span lang="zxx">Documentazione e ulteriori informazioni nella pagina del plugin: </span><a href="http://plugins.cordova.io/#/package/org.apache.cordova.geolocation"><span lang="zxx">http://plugins.cordova.io/#/package/org.apache.cordova.geolocation</span></a></p>
</li>
<li>
<p class="western"><span lang="zxx"><a href="http://plugins.cordova.io/#/package/org.apache.cordova.statusbar">Cordova StatusBar Plugin</a>: permette di avere un'integrazione con la status bar di iOS 7, in modo tale da avere stesso look and feel di una applicazione nativa. </span><span lang="zxx">Documentazione e ulteriori informazioni nella pagina del plugin: </span><span lang="zxx"><a href="http://plugins.cordova.io/#/package/org.apache.cordova.statusbar">http://plugins.cordova.io/#/package/org.apache.cordova.statusbar</a></span></p>
</li>
</ul>
<p><!--more--></p>
<p><!--more--></p>
<h3>Ionic</h3>
<p class="western">Per realizzare l'interfaccia grafica dell'applicazione è stato utilizzato <a href="http://ionicframework.com/">Ionic</a> un framework open source che utilizza AngularJS e fornisce agli sviluppatori componenti (HTML/CSS/Javascript) ed alcuni plugin per Cordova.</p>
<p class="western">I componenti forniti hanno <i>directive</i> da utilizzare nelle view HTML ed <i>API</i> da utilizzare nei corrispondenti controller.</p>
<p class="western">Ionic è un framework molto giovane e nella fase iniziale di realizzazione e diffusione. All'inizio della scrittura dell'applicazione era stata da poco pubblicata la prima beta pubblica, ad oggi è stata rilasciata l'ottava beta.</p>
<p class="western">Per l'applicazione sono stati utilizzati i seguenti componenti:</p>
<ul>
<li>
<p class="western"><a href="http://ionicframework.com/docs/api/directive/ionNavView/">ion-nav-view</a>: componente che tiene traccia della storia di navigazione dell'utente all'interno dell'applicazione fornendo animazioni tra una view ed un altra. Utilizza UI-Router per gestire i vari stati dell'applicazione</p>
</li>
<li>
<p class="western"><a href="http://ionicframework.com/docs/api/directive/ionNavBar/">ion-nav-bar</a>: per gestire l'header di ogni view inserendo titoli e pulsanti personalizzati</p>
</li>
<li>
<p class="western"><a href="http://ionicframework.com/docs/api/directive/ionTabs/">ion-tabs</a>: permette di utilizzare il layout <i>a tabs</i> ed associare ad ogni <i>tab</i> una diversa view</p>
</li>
<li>
<p class="western"><a href="http://ionicframework.com/docs/api/service/$ionicModal/">i</a><a href="http://ionicframework.com/docs/api/service/$ionicModal/">onicModal</a>: per la gestione di view modali</p>
</li>
<li>
<p class="western"><a href="http://ionicframework.com/docs/api/service/$ionicPopup/">ionicPopup</a>: per notificare l'utente</p>
</li>
</ul>
<h3>Estensioni AngularJS</h3>
<p class="western">Sono state utilizzate anche le seguenti estensioni per AngularJS:</p>
<ul>
<li>
<p class="western"><a href="https://github.com/nlaplante/angular-google-maps">Angular-google-maps :</a> fornisce <i>directives</i> per utilizzare google maps all'interno di applicazioni AngularJS</p>
</li>
<li>
<p class="western"><a href="https://github.com/Pasvaz/bindonce">Bindonce</a>: utilizzato quando possibile per aumentare le performances</p>
</li>
</ul>
<p class="western">A causa del two-way data binding di AngularJS la directive <i>ng-repeat</i> causa dei deterioramenti di performances poiché AngularJS utilizza un meccanismo di <i>dirty checking</i> per controllare se sono state effettuate modifiche negli elementi. Utilizzando bindonce viene “rotto” questo two-way data binding per gli elementi specificati, e dopo aver fatto il rendering degli elementi nella view AngularJS non controllerà eventuali modifiche. Ho utilizzato bindonce nella lista di fotografie visualizzate nella timeline.</p>
<p class="western">Le future versioni di AngularJS dovrebbero utilizzare il metodo Object.observe() (non ancora supportato da tutti i browser) per velocizzare queste operazioni ed il team di AngularJS ha dichiarato di avere già ottenuto un <a href="https://mail.mozilla.org/pipermail/es-discuss/2012-September/024978.html">incremento delle prestazioni del 20-40%</a>.</p>
<h2 class="western">Struttura dell'Applicazione</h2>
<p class="western">Per la scrittura dell'applicazione ho realizzato tre moduli AngularJS, ed ho organizzato i file in modo da avere un componente in ogni file separato, definendo tutti i moduli nel file <a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/app.js"><i>app.js</i></a> e utilizzando il metodo <i>getter</i> <i>angular.module</i> per ottenere in ogni file il modulo desiderato per poterci definire e registrare il componente.</p>
<h3 class="western">Services</h3>
<p class="western">Il modulo MyPhotoDiary.services è così definito:</p>
<blockquote><p>angular.module('MyPhotoDiary.services',[]);</p></blockquote>
<p class="western">ed è richiamato in ogni file dentro la cartella scripts/services per poter definire un servizio in ogni file separato (ho fatto questa scelta perché preferisco avere più file piccoli ognuno con limitate responsabilità, poi in fase di deploy i fari file <i>.js</i> vengono concatenati e il file risultante viene minimizzato).</p>
<p class="western">Ho realizzato i seguenti <i>services</i>:</p>
<ul>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/services/CameraService.js">CameraService</a>: utilizza le API fornite dal plugin Cordova Camera per scattare fotografie e restituisce una <i>promise</i>.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/services/GeolocationService.js">GeolocationService</a>: utilizza le API fornite dal plugin Cordova Geolocation plugin per ottenere le coordinate gps e restituisce una <i>promise</i>.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/services/PicturesService.js">PicturesService</a>: gestisce le fotografie dell'applicazione, utilizza il <i>local storage</i> per memorizzare la descrizione, il path su filesystem locale e le coordinate di ogni fotografia. Per l'operazione di rimozione di fotografie dal filesystem utilizza StorageSettings e restituisce una <i>promise </i>(le operazioni su filesystem in Javascript sono asincrone). Emette l'evento <i>NewPicture </i>nel<i> </i><i>rootScope</i> ogni volta viene realizzata una nuova fotografia, in modo tale che qualunque controller possa gestire questo evento una volta sottoscritto. (AngularJS rilascia un controller se l'utente non è nella view correlata, quindi ho scelto di avere un evento globale in modo tale da poterlo gestire indipendentemente dalla view corrente dell'utente)</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/services/SettingsService.js">SettingsService</a>: memorizza le preferenze dell'utente utilizzando il <i>local</i> <i>storage</i>.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/services/StorageService.js">StorageService</a>: utilizza le API fornite dal plugin Cordova File e permette di memorizzare e cancellare le foto dal filesystem. Per le operazioni restituisce una <i>promise</i>.</p>
</li>
</ul>
<h3>Controllers</h3>
<p class="western">Il modulo MyPhotoDiary.controllers è così definito:</p>
<blockquote><p>angular.module('MyPhotoDiary.controllers',['MyPhotoDiary.services']);</p></blockquote>
<p class="western">e come già spiegato per il modulo relativo ai services è richiamato all'interno di ogni file dentro la cartella scripts/controllers.</p>
<p class="western">Sono stati realizzati i seguenti controllers:</p>
<ul>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/controllers/MainNavBarController.js">MainNavBarController</a>: gestisce la navigation bar presente in ogni view dove è situato un pulsante per scattare una nuova fotografia. Utilizza i services <i>CameraService</i>, <i>GeolocationService</i>, <i>PicturesService</i> e <i>StorageService</i> per catturare e memorizzare la nuova foto. Usa anche <i>ionicModal</i> per mostrare all'utente una view modale per confermare o scartare la nuova fotografia, e <i>ionicPopup</i> per visualizzare eventuali errori.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/controllers/PlacesController.js">PlacesController</a>: responsabile della creazione dei marker da visualizzare sulla mappa. Utilizza <i>GeolocationService</i> per centrare la mappa nella posizione corrente dell'utente e <i>PicturesService</i> per recuperare le foto da mostrare. Gestisce l'evento <i>NewPicture</i> reindirizzando l'utente alla view timeline.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/controllers/SettingsController.js">SettingsController</a>: permette di scegliere di quante foto effettuare il prefetch per essere visualizzate nella timeline e di eliminare tutte le foto dell'applicazione. Usa <i>PicturesService</i> per calcolare quante fotografie sono attualmente memorizzate e <i>SettingsService</i> per memorizzare le preferenze utente. Anche questo controller gestisce l'evento <i>NewPicture</i> reindirizzando l'utente alla view timeline.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/controllers/TimelineController.js">TimelineController</a>: gestisce la condivisione e l'eliminazione della foto selezionata nella corrispettiva view. Inoltre carica ulteriori foto e le aggiunge alla view non appena l'utente raggiunge il limite inferiore dello scroll della view, infatti per motivi di performances non vengono immediatamente caricate tutte le foto nella view. Utilizza <i>PicturesService</i> per richiedere le foto memorizzate mano a mano che l'utente scorre la view e <i>SettingsService</i> per sapere di quante foto effettuare il prefetch. Gestisce l'evento <i>NewPicture</i> aggiungendo la nuova foto in cima alla view e tornando all'inizio della lista di fotografie.</p>
</li>
</ul>
<h3>Modulo Principale</h3>
<p class="western">Il modulo MyPhotoDiary è così definito:</p>
<blockquote lang="zxx"><p>angular.module('MyPhotoDiary', ['ionic', 'MyPhotoDiary.controllers', 'MyPhotoDiary.services', 'google-maps', 'pasvaz.bindonce'])</p></blockquote>
<p class="western">Ed è configurato nel file <a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/scripts/app.js"><i>app.js</i></a> specificando per ogni stato dell'applicazione (usando UI-router) il rispettivo nome, url, template e controller.</p>
<p class="western">Gli stati sono:</p>
<ul>
<li>
<p class="western">tabs: stato astratto con template <i>tabs.html</i>. Uno stato astratto non può mai essere direttamente attivato, sarà attivato uno dei suoi stati figli.</p>
</li>
<li>
<p class="western">tabs.places: mappato su url <i>/places</i> utilizza il template <i>places.html</i> ed il controller <i>PlacesController.</i></p>
</li>
<li>
<p class="western">tabs.timeline: mappato su url <i>/timeline</i> utilizza il template <i>timeline.html</i> ed il controller <i>TimelineController</i>.</p>
</li>
<li>
<p class="western">tabs.settings: mappato su url <i>/settings</i> utilizza il template <i>settings.html</i> ed il controller <i>SettingsController</i>.</p>
</li>
</ul>
<p class="western">All'avvio dell'applicazione viene impostato lo stato tabs.timeline.</p>
<h3 class="western">Views</h3>
<p class="western">I template di ogni view sono salvati all'interno della cartella <i>templates</i> e sono:</p>
<ul>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/templates/confirmPhoto.html">confirmPhoto</a>: una view modale che visualizza la foto appena scattata e permette di confermarne il salvataggio oppure di scartarla. E' gestita da <i>MainNavController</i>.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/templates/places.html">places</a>: contiene una google map e un marker per ogni foto nella posizione in cui è stata scattata. Utilizza la direttiva &lt;google-map&gt; fornita da <i>Angular-google-maps</i>.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/templates/settings.html">settings</a>: attraverso uno slider permette all'utente di scegliere il numero di fotografie di cui fare il prefetch nella timeline ed ha un pulsante per eliminare tutte le foto memorizzate.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/templates/tabs.html">tabs</a>: visualizza tre tab, uno per lo stato tabs.timeline, uno per lo stato tabs.places e uno per lo stato tabs.settings.</p>
</li>
<li>
<p class="western"><a href="https://github.com/dcampogiani/My-Photo-Diary/blob/master/app/templates/timeline.html">timeline</a>: mostra in una lista in ordine cronologico le fotografie memorizzate e sotto ognuna di essa due pulsanti, uno per eliminare ed uno per condividere la foto.</p>
</li>
</ul>
<h2>Tools</h2>
<p class="western">Per velocizzare il workflow sono stati utilizzati alcuni tool open source, ne riporto in seguito una breve descrizione per ognuno.</p>
<h3 class="western">Grunt</h3>
<p class="western"><a href="http://gruntjs.com/">Grunt</a> è un task runner scritto in Javascript con molti tool e plugin resi disponibili dalla comunità, tra i plugin che ho utilizzato segnalo <i>bower-install </i>che inietta le dipendenze gestite con <i>bower</i> nell'HTML, <i>concat</i> che concatena diversi fine in uno unico, <i>ngmin</i>, <i>cssmin</i> che comprime i file CSS, <i>uglify</i> per minimizzare il codice Javascript e <i>htmlmin</i> che minimizza il codice HTML.</p>
<p class="western"><span style="font-family: Helvetica, sans-serif;">È installabile attraverso <a href="https://www.npmjs.org/">npm</a> (package manager di <a href="http://nodejs.org/">node.js</a>).</span></p>
<h3 class="western">Bower</h3>
<p class="western"><a href="http://bower.io/"><span style="font-family: Helvetica, sans-serif;">B</span><span style="font-family: Helvetica, sans-serif;">ower</span></a><span style="font-family: Helvetica, sans-serif;"> è </span><span style="font-family: Helvetica, sans-serif;">un package manager per componenti web. Per l'applicazione ho specificato come dipendenze </span><span style="font-family: Helvetica, sans-serif;"><i>AngularJS</i></span><span style="font-family: Helvetica, sans-serif;">, </span><span style="font-family: Helvetica, sans-serif;"><i>Ionic</i></span><span style="font-family: Helvetica, sans-serif;">, </span><span style="font-family: Helvetica, sans-serif;"><i>angular-google-maps</i></span><span style="font-family: Helvetica, sans-serif;"> e </span><span style="font-family: Helvetica, sans-serif;"><i>angular-bindonce.</i></span><span style="font-family: Helvetica, sans-serif;"> Bower provvede a scaricare in locale l'ultima versione (o la versione specificata) delle dipendenze, in modo tale che facendone il deploy sul dispositivo non sia necessaria alcuna connettività di rete.</span></p>
<p class="western"><span style="font-family: Helvetica, sans-serif;">A</span><span style="font-family: Helvetica, sans-serif;">nche bower è reperibile attraverso npm.</span></p>
<h3 class="western">Yeoman</h3>
<p class="western"><a href="http://yeoman.io/"><span style="font-family: Helvetica, sans-serif;">Yeoman</span></a><span style="font-family: Helvetica, sans-serif;"> è </span><span style="font-family: Helvetica, sans-serif;">un tool che automatizza il setup degli </span><span style="font-family: Helvetica, sans-serif;">strumenti</span><span style="font-family: Helvetica, sans-serif;"> precedentemente descritti </span><span style="font-family: Helvetica, sans-serif;">grazie a </span><span style="font-family: Helvetica, sans-serif;"><i>generator</i></span><span style="font-family: Helvetica, sans-serif;"> resi disponibili dalla comunità (attualmente ci sono più di 700 </span><span style="font-family: Helvetica, sans-serif;"><i>generators</i></span><span style="font-family: Helvetica, sans-serif;">).</span></p>
<p class="western"><span style="font-family: Helvetica, sans-serif;">P</span><span style="font-family: Helvetica, sans-serif;">er lo sviluppo di questa applicazione ho utilizzato il </span><span style="font-family: Helvetica, sans-serif;"><i>generator</i></span><span style="font-family: Helvetica, sans-serif;"> chiamato </span><span style="font-family: Helvetica, sans-serif;"><i>generator-ionic</i></span><span style="font-family: Helvetica, sans-serif;"> disponibile in maniera open source all'indirizzo <a href="https://github.com/diegonetto/generator-ionic">https://github.com/diegonetto/generator-</a><a href="https://github.com/diegonetto/generator-ionic">ionic</a>.</span></p>
<p class="western"><span style="font-family: Helvetica, sans-serif;">Anche yeoman è reperibile con npm.</span></p>
